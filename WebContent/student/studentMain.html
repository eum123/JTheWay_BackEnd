<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>haami student</title>

    <link href="../theme/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../theme/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="../theme/css/animate.css" rel="stylesheet" />
    <link href="../theme/css/style.css" rel="stylesheet" />
    <!-- Toastr style -->
    <link href="../theme/css/plugins/toastr/toastr.min.css" rel="stylesheet" />
    <link
      href="../theme/css/plugins/datapicker/datepicker3.css"
      rel="stylesheet"
    />
  </head>

  <body class="top-navigation">
    <div id="app">
      <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
          <div class="row border-bottom white-bg">
            <nav
              class="navbar navbar-expand-lg navbar-static-top"
              role="navigation"
            >
              <a href="#" class="navbar-brand">haami</a>
              <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbar"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <i class="fa fa-reorder"></i>
              </button>

              <div class="navbar-collapse collapse" id="navbar">
                <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="nav navbar-top-links navbar-right">
                  <li>
                    <a href="login.html">
                      <i class="fa fa-sign-out"></i> Log out
                    </a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
          <div class="wrapper wrapper-content">
            <div>
              <div class="row col-lg-12" id="empty">
                <div class="sk-spinner sk-spinner-fading-circle">
                  <div class="sk-circle1 sk-circle"></div>
                  <div class="sk-circle2 sk-circle"></div>
                  <div class="sk-circle3 sk-circle"></div>
                  <div class="sk-circle4 sk-circle"></div>
                  <div class="sk-circle5 sk-circle"></div>
                  <div class="sk-circle6 sk-circle"></div>
                  <div class="sk-circle7 sk-circle"></div>
                  <div class="sk-circle8 sk-circle"></div>
                  <div class="sk-circle9 sk-circle"></div>
                  <div class="sk-circle10 sk-circle"></div>
                  <div class="sk-circle11 sk-circle"></div>
                  <div class="sk-circle12 sk-circle"></div>
                </div>
              </div>
            </div>
            <div class="container" style="display: none;" id="content">
              <div class="row">
                <div class="col-lg-12">
                  <div class="ibox" id="studentName">
                    <div class="ibox-title">
                      <div class="row">
                        <h3>
                          {{studentInfo.name}} 학생,
                        </h3>
                        <h5>안녕하세요</h5>
                      </div>
                    </div>
                    <div class="ibox-content">
                      <div class="m-t-sm">
                        <div class="row">
                          <div class="col-md-4">
                            <div><h4>학원 공지사항</h4></div>
                            <div class="animated fadeIn">
                              <table class="table">
                                <thead></thead>
                                <tbody>
                                  <tr v-for="noti in notice">
                                    <td>{{noti}}</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                          <div class="col-md-8 animated fadeIn">
                            <h3>{{month.month}}월 현황</h3>
                            <ul class="list-group clear-list m-t">
                              <li class="list-group-item fist-item">
                                <div class="row">
                                  <div class="col-md-6">
                                    <h5>출결 상황</h5>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="text-right"
                                      ><h2>{{month.attendanceRate}}%</h2></span
                                    >
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="progress progress">
                                      <div
                                        :style="{width: month.attendanceRate + '%'}"
                                        class="progress-bar"
                                      ></div>
                                    </div>
                                  </div>
                                </div>
                              </li>
                              <li class="list-group-item">
                                <div class="row">
                                  <div class="col-md-6">
                                    <h5>온라인 테스트</h5>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="text-right"
                                      ><h2>{{month.examRate}}%</h2></span
                                    >
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="progress progress">
                                      <div
                                        :style="{width: month.examRate + '%'}"
                                        class="progress-bar"
                                      ></div>
                                    </div>
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <div class="ibox" id="questionList">
                    <div class="ibox-title">
                      <div class="m-t-sm">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-group" id="data_1">
                              <div class="input-group date">
                                <span class="input-group-addon"
                                  ><i class="fa fa-calendar"></i></span
                                ><input
                                  id="questionDate"
                                  type="text"
                                  class="form-control"
                                  value="2020/03/04"
                                />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <select
                              id="isTakeExam"
                              class="select2_demo_2 form-control"
                            >
                              <option value="미응시" selected>미응시</option>
                              <option value="응시">응시</option>
                              <option value="채점">채점</option>
                            </select>
                          </div>
                          <div class="col-md-3">
                            <button
                              type="button"
                              class="btn btn-outline btn-primary"
                            >
                              검색
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="ibox-content animated fadeIn">
                      <div class="sk-spinner sk-spinner-fading-circle">
                        <div class="sk-circle1 sk-circle"></div>
                        <div class="sk-circle2 sk-circle"></div>
                        <div class="sk-circle3 sk-circle"></div>
                        <div class="sk-circle4 sk-circle"></div>
                        <div class="sk-circle5 sk-circle"></div>
                        <div class="sk-circle6 sk-circle"></div>
                        <div class="sk-circle7 sk-circle"></div>
                        <div class="sk-circle8 sk-circle"></div>
                        <div class="sk-circle9 sk-circle"></div>
                        <div class="sk-circle10 sk-circle"></div>
                        <div class="sk-circle11 sk-circle"></div>
                        <div class="sk-circle12 sk-circle"></div>
                      </div>
                      <div class="m-t-sm">
                        <div class="row">
                          <div class="col-md-12 text-right">
                            전체 {{questions.pagination.total}}건
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-12">
                            <table class="table table-bordered">
                              <thead>
                                <tr>
                                  <th class="text-center">NO</th>
                                  <th class="text-center">년도</th>
                                  <th class="text-center">클래스</th>
                                  <th class="text-center">커리큘럼</th>
                                  <th class="text-center">출제일자</th>
                                  <th class="text-center">응시일자</th>
                                  <th class="text-center">문항수</th>
                                  <th class="text-center">점수</th>
                                  <th class="text-center">응시여부</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr v-for="question in questions.list">
                                  <td class="text-center">{{question.no}}</td>
                                  <td class="text-center">{{question.year}}</td>
                                  <td>{{question.class}}</td>
                                  <td>
                                    {{question.curriculum}}
                                  </td>
                                  <td class="text-center">
                                    {{question.exam.questionsDate}}
                                  </td>
                                  <td class="text-center">
                                    {{question.exam.isTakeExam == 1 ?
                                    question.exam.doDate : '-'}}
                                  </td>
                                  <td class="text-center">
                                    {{question.exam.count}}
                                  </td>
                                  <td class="text-center">
                                    <span v-if="question.exam.isTakeExam == 0"
                                      >-</span
                                    >
                                    <span
                                      v-else-if="question.exam.status == 'fail'"
                                      class="badge badge-danger"
                                      >Fail : {{question.exam.score}}</span
                                    >
                                    <span
                                      v-else="question.exam.status == 'fail'"
                                      class="badge badge-primary"
                                      >Pass : {{question.exam.score}}</span
                                    >
                                  </td>
                                  <td class="text-center">
                                    {{question.exam.isTakeExam == 1 ?
                                    question.exam.doDate : '미응시'}}
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-12 text-center">
                            <div class="btn-group">
                              <button
                                type="button"
                                class="btn btn-white"
                                @click="movePage(questions.pagination.pageInfo.prePageNumber)"
                              >
                                <i class="fa fa-chevron-left"></i>
                              </button>
                              <button
                                v-for="page in questions.pagination.pageInfo.pageNumbers"
                                v-bind:class="pageClassObject(page)"
                                @click="movePage(page)"
                              >
                                {{page}}
                              </button>
                              <button
                                type="button"
                                class="btn btn-white"
                                @click="movePage(questions.pagination.pageInfo.nextPageNumber)"
                              >
                                <i class="fa fa-chevron-right"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="footer">
            <div class="float-right">
              <strong>haami</strong> institute &copy; 2020
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../resources/js/api.js"></script>
    <script src="../resources/js/common.js"></script>

    <!-- Mainly scripts -->
    <script src="../theme/js/jquery-3.1.1.min.js"></script>
    <script src="../theme/js/popper.min.js"></script>
    <script src="../theme/js/bootstrap.js"></script>
    <script src="../theme/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="../theme/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="../theme/js/inspinia.js"></script>
    <script src="../theme/js/plugins/pace/pace.min.js"></script>

    <!-- Flot -->
    <script src="../theme/js/plugins/flot/jquery.flot.js"></script>
    <script src="../theme/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="../theme/js/plugins/flot/jquery.flot.resize.js"></script>

    <!-- ChartJS-->
    <script src="../theme/js/plugins/chartJs/Chart.min.js"></script>

    <!-- Peity -->
    <script src="../theme/js/plugins/peity/jquery.peity.min.js"></script>
    <!-- Peity demo -->
    <script src="../theme/js/demo/peity-demo.js"></script>

    <!-- Data picker -->
    <script src="../theme/js/plugins/datapicker/bootstrap-datepicker.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.2/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      var LIST_COUNT = 10;
      var PAGENUMBER_COUNT = 10;

      var data = new Object();
      init();

      var vm = new Vue({
        el: "#app",
        data() {
          return data;
        },
        methods: {
          movePage: function (page) {
            //start loading
            $("#questionList")
              .children(".ibox-content")
              .toggleClass("sk-loading");

            console.log("move page : " + page);

            //현재 페이지 설정
            this.questions.pagination.currentPage = page;
            syncGet(
              "https://raw.githubusercontent.com/joshua1988/doit-vuejs/master/data/demo.json",
              "",
              questions,
              null
            );

            //end loading
            $("#questionList")
              .children(".ibox-content")
              .toggleClass("sk-loading");
          },
          pageClassObject: function (page) {
            if (this.questions.pagination.currentPage == page) {
              return "btn btn-white active";
            } else {
              return "btn btn-white ";
            }
          },
        },
        mounted: function () {
          //로딩 화면 제거하고 화면 표시
          $("#empty").css("display", "none");
          $("#content").css("display", "");

          var mem = $("#data_1 .input-group.date").datepicker({
            format: "yyyymmdd",
            update: new Date(),
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: true,
            autoclose: true,
          });
          $("#questionDate").val(new Date().format("yyyymmdd"));
          console.log($("#questionDate").val());
        },
      });

      function studentInfo(res) {
        if (res != null) {
          //test
          data.studentInfo = JSON.parse('{"name": "홍길동"}');
        }
      }
      function notice(res) {
        if (res != null) {
          //data.notice = res;
          //test
          data.notice = JSON.parse(
            '["1. 공지사항1","2. 공지사항1","3. 공지사항1","4. 공지사항1","5. 공지사항1"]'
          );
        }
      }
      function monthly(res) {
        if (res != null) {
          //test
          data.month = JSON.parse(
            '{"month": 3, "attendanceRate": 30, "examRate": 30}'
          );
        }
      }

      function questions(res) {
        if (data != null) {
          //test
          data.questions = JSON.parse(
            '{"list":[{"no":2,"year":"2020","class":"class","curriculum":"중1 > 1학기 > 소인수분해 > 01 소인수분해","exam":{"count":10,"questionsDate":"2020.02.09","doDate":"2020.02.10","status":"pass","score":10,"isTakeExam":"1"}},{"no":1,"year":"2020","class":"class","curriculum":"중1 > 1학기 > 소인수분해 > 01 소인수분해","exam":{"count":10,"questionsDate":"","doDate":"","status":"-","score":0,"isTakeExam":"0"}}],"pagination":{"total":50, "currentPage":1}}'
          );

          //현재페이지
          var currentPage = data.questions.pagination.currentPage;
          var totalCount = data.questions.pagination.total;

          data.questions.pagination.pageInfo = getPageInfo(
            totalCount,
            currentPage
          );

          console.log(data.questions.pagination);
        }
      }

      function init() {
        //학생정보
        syncGet(
          "https://raw.githubusercontent.com/joshua1988/doit-vuejs/master/data/demo.json",
          "",
          studentInfo,
          null
        );

        //공지사항
        syncGet(
          "https://raw.githubusercontent.com/joshua1988/doit-vuejs/master/data/demo.json",
          "",
          notice,
          null
        );

        //월현황
        syncGet(
          "https://raw.githubusercontent.com/joshua1988/doit-vuejs/master/data/demo.json",
          "",
          monthly,
          null
        );

        //문제현황
        syncGet(
          "https://raw.githubusercontent.com/joshua1988/doit-vuejs/master/data/demo.json",
          "",
          questions,
          null
        );
      }
      /**
       * page 번호 목록 생성
       */
      function getPageInfo(totalCount, currentPage) {
        var totalPage = totalCount / LIST_COUNT;

        if (totalCount % LIST_COUNT > 0) {
          totalPage++;
        }

        //currentPage = 현재 보고있는 페이지
        if (totalPage < currentPage) {
          currentPage = totalPage;
        }

        var startPage =
          ((currentPage - 1) / PAGENUMBER_COUNT) * PAGENUMBER_COUNT + 1;
        //현재 페이지가 pageCount와 같을 때를 유의하며 (page-1)을 하고
        // +1은 첫페이지가 0이나 10이 아니라 1이나 11로 하기 위함임
        var endPage = startPage + PAGENUMBER_COUNT - 1;
        // -1은 첫페이지가 1이나 11 등과 같을때 1~10, 11~20으로 지정하기 위함임

        if (endPage > totalPage) {
          endPage = totalPage;
        }

        var pageNumbers = new Array();

        for (var i = startPage; i <= endPage; i++) {
          pageNumbers.push(i);
        }

        //pre page
        var prePageNumber = 1;
        if (startPage > 1) {
          prePageNumber = startPage - 1;
        }
        //next page
        var nextPageNumber = totalPage;
        if (totalPage > endPage) {
          nextPageNumber = endPage + 1;
        }

        var pageInfo = new Object();
        pageInfo.pageNumbers = pageNumbers;
        pageInfo.prePageNumber = prePageNumber;
        pageInfo.nextPageNumber = nextPageNumber;

        return pageInfo;
      }
    </script>
  </body>
</html>
